"use strict";var proxymity=function(e){function t(e){return Array.prototype.slice.call(e||[])}function n(e,n){return t(e).forEach(n)}function r(e){return"function"==typeof e}function o(e){return"string"==typeof e}function i(e){return"boolean"==typeof e}function a(e){return"object"==typeof e}function u(e){return Object.getOwnPropertyNames(e)}function c(e,t){var n,r,o;return void 0===t||e>t?(r=e,n=t||0):(n=e,r=t),o=r-n,Math.round(Math.random()*(o+.9998)-.4999)+n}var s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";function f(e=16){for(var t=s[c(51)],n=1;n<e;n++)t+=s[c(62)];return t}function l(e,t){var r=u(t);for(var o in e)t[o]=e[o],r.splice(r.indexOf(o),1);n(r,function(e){delete t[e]})}var v=function(){var e=f(c(32,48)),t=!1,r=[];return window.addEventListener("message",function(o){if(o.data===e){o.stopPropagation();var i=r;e=f(c(32,48)),t=!1,r=[],n(i,function(e){e()})}}),function(n){t||(window.postMessage(e,"*"),t=!0),r.push(n)}}();var p={objectify:function(){if(Array.isArray(this))var e=[];else e={};var t=u(this);for(var n in t){var r=t[n];a(this[r])&&this[r].objectify?e[r]=this[r].objectify():e[r]=this[r]}return e},stringify:function(){var e=t(arguments);return e.unshift(p.objectify.call(this)),JSON.stringify.apply(JSON,e)},toString:function(){return u(this).length?p.stringify.call(this):""}};p[Symbol.toPrimitive]=function(e){return"number"==e?u(this).length:"string"==e?p.toString.call(this):!!u(this).length};var h=Object.create(Array.prototype);n(u(p),function(e){h[e]=p[e]});var y=f(c(32,48)),d=f(c(32,48)),g=f(c(32,48));var m=/\{\:([\s\S]*?)\:\}/g;function b(t,n,r){r=r||t;var o=t.textContent;if(o.match(m))var i=n.watch("asyncstart",function(n){var i,a=!1;e:for(var u in n.payload)if("set:"===u.substring(0,4)){a=!0;break e}a&&(t.textContent=(i=r,o.replace(m,function(t,n){try{return e.call(i,n)}catch(e){console.warn("failed to render expression ["+n+"]",e)}})))});return function(){t.textContent=o,i&&i()}}var k=Object.create(Array.prototype);function w(e,t){n(e,function(e,n,r){t(e),w(e.childNodes,t)})}k.appendTo=function(e){if(o(e))return k.appendTo.call(this,document.querySelector(e));var t=e;return n(this,function(e){t.appendChild(e)}),this},k.detach=function(){return n(this,function(e){var t=e.parentElement;t&&t.removeChild(e)}),this};var O=f(c(32,48));function x(e,t,r,o){o.source.length;var i="set:"+e.last("get").value,a=function(i){if(void 0!==i){var a,u,c,s,f=o.outputList.indexOf(o.insertBefore),l=o.outputList.indexOf(o.insertAfter),v=o.outputList,p=o.insertBefore.parentNode,h=(a=v.slice(l+1,f),u=o.key,c=[],n(a,function(e){var t=e[u];c[t]=c[t]||[],c[t].push(e)}),c);if(h.length<o.source.length)for(;h.length!==o.source.length;){var y=o.elements.map(function(e){return e.cloneNode(!0)});w(y,function(e){Object.defineProperty(e,o.key,{configurable:!0,enumerable:!1,get:function(e){return e}.bind(e,h.length)})}),A(y,t,e,r),p&&n(y,function(e){p.insertBefore(e,o.insertBefore)}),o.onClone&&n(y,function(e){e instanceof HTMLElement&&o.onClone(e)}),v.splice.apply(v,[f,0].concat(y)),f+=y.length,h.push(y)}else if(h.length>o.source.length)for(;h.length!==o.source.length;){var d=h.pop();n(d,function(e){v.splice(v.indexOf(e),1),e.parentNode&&e.parentNode.removeChild(e)}),w(s=d,function(e){e.dispatchEvent(new CustomEvent(O))}),n(s,function(e){e.parentNode&&e.parentNode.removeChild(e)})}}};e.watch("asyncstart",function(e){e.payload.hasOwnProperty(i)&&a(e.payload[i])}),a(e.next(i)||e.last(i))}function A(u,s,v,p){if(o(u)){var h=document.createElement("template");return h.innerHTML=u.trim(),A(h.content.childNodes,s,v,p)}if(u instanceof NodeList||u instanceof Array&&u.reduce(function(e,t){return e&&t instanceof Node},!0)){var d,g=[],m=t(u),w=function(e){if(d)throw new error("Improper usage of key(string).in(array): key(string) cannot be nested on the same level");return d={key:e},w};return w.in=function(e){if(!d)throw new Error("Improper usage of key(string).in(array): key(string) not called");if(d.source)throw new Error("Improper usage of key(string).in(array): in(array) called before key");if(!Array.isArray(e)||!e[y])throw new Error("Improper usage of key(string).in(array): in(array) is not provided with a proxified array");d.source=e,d.elements=[]},w.end=function(e){if(!(d&&d.key&&d.source&&d.elements&&d.elements.length))throw new Error("Improper usage of key.end([onClone]): key(string).in(array) is not called properly prior to calling key.end([onClone])");d.outputList=m,d.insertBefore=d.elements.pop(),r(e)&&(d.onClone=e),g.push.apply(g,d.elements);for(var t=m.length-1;t>=0;t--)-1!==g.indexOf(m[t])&&m.splice(t,1);d.insertAfter=d.insertBefore.previousSibling,x(v,s,p,d),d=void 0},n(m,function(t){if(d&&d.elements&&d.elements.push(t),t instanceof Comment&&"foreach:"===t.textContent.trim().substr(0,8).toLowerCase()&&(A(t,s,v,p),e.call(t,t.textContent,{key:w}),d&&(!d.key||!d.source||!d.elements)))throw new Error("Improper usage of key(string).in(array): in(array) not called in conjunction with key")}),n(m,function(e){e[p]!==s&&A(e,s,v,p)}),Object.setPrototypeOf(m,k)}if(u instanceof Node){var N=u,E=[];if(Object.defineProperty(N,p,{configurable:!0,get:function(){return s},set:function(e){a(e)&&l(e,s)}}),E.push(function(){delete N[p]}),N instanceof CharacterData){var j=b(N,v);E.push(j)}else A(N.childNodes,s,v,p);n(N.attributes,function(t){var r="name"!==t.name&&b(t,v,N);if(r&&E.push(r),!("name"!==t.name||"INPUT"!==N.nodeName&"TEXTAREA"!==N.nodeName&"SELECT"!==N.nodeName)){var o=function(e){try{var t=e.value.toString();t!==N.value&&(N.value=t)}catch(e){N.value=null}},u=function(e){a(e)&&(N.value=null)},l="value",h=N.type.toLowerCase();"number"===h||"range"===h?(l="valueAsNumber",o=function(e){e&&"number"==typeof e.value?"number"==typeof e.value&&e.value!==N.valueAsNumber&&(N.valueAsNumber=e.value):N.value=null}):"checkbox"===h?(l="checked",o=function(e){!e||i(e.value)?N.checked=!1:i(e.value)&&e.value!==N.checked&&(N.checked=e.value)}):"radio"===h?o=function(e){try{var t=e.value.toString();e&&N.value===t&&!0!==N.checked?N.checked=!0:e&&N.value!==t&&!0===N.checked&&(N.checked=!1)}catch(e){N.checked=!1}}:"date"!==h&&"month"!==h&&"week"!==h&&"time"!==h&&"datetime-local"!==h||(l="valueAsDate",o=function(e){e&&e.value instanceof Date?e.value instanceof Date&&e.value.getTime()!==N.valueAsDate.getTime()&&(N.valueAsDate=e.value):N.value=null}),u.to="del",o.to="set",function t(n,r,o,i,a,u,c){e.call(n,"this."+r+("["===a[0]?"":".")+a);var s=o.last("get").value,f={};for(var l in u){var v=u[l].to+":"+s;c.push(f[u[l].to]=o.watch(v,u[l])),u[l](o.next(v)||o.last(v))}c.push(f[s]=o.watch("remap:"+s,function(){for(var e in f){f[e]();var s=c.indexOf(f[e]);s>-1&&c.splice(s,1)}t(n,r,o,i,a,u,c)}))}(N,p,v,s,t.value,[u,o],E);var y=["change","keyup"],d=function(n){var r=f(c(32,48));e.call(N,"this."+p+("["===t.value[0]?"":".")+t.value+" = "+r,{[r]:N[l]})};n(y,function(e){N.addEventListener(e,d)}),E.push(function(){n(y,function(e){N.removeEventListener(e,d)})})}});var C=function(e){e.stopPropagation(),n(E,function(e){e()})};return N.addEventListener(O,C),E.push(function(){N.removeEventListener(O,C)}),Object.setPrototypeOf([N],k)}}return function(e,t={},o="app"){var i=new function(){var e={},t={},o=(this.watch=function(n,o,i){var a,u;for(var c in r(o)?(a=n,u=o,i=i||{}):(a="**",u=n,i=o||{}),i)u.key=i.key;if(a.indexOf("*")>-1)var s=a.replace(/([!@#$%^&*(){}[\]\<\>:'"`\-_,./\\+-])/g,"\\$1").replace(/\\\*\\\*/g,".*").replace(/\\\*/,"[^:.]+"),f=(t[a]=t[a]||{regex:new RegExp(s),listeners:[]}).listeners;else f=e[a]=e[a]||[];return f.push(u),function(){f.splice(f.indexOf(u),1)}},{}),i=this.emit=function(r,i={}){for(var a=0;e[r]&&a<e[r].length;a++)e[r][a](i,r);for(var u in t){var c=t[u];r.match(c.regex)&&n(c.listeners,function(e){e(i,r)})}return o[r]=i},a={},c=0,s=0,f=!1;this.async=function(e,t={}){f||(v(function(){var e=a;if(f=!1,a={},c=0,++s>3)s=0;else{var t=u(e);t.sort(function(t,n){return e[t].order>e[n].order?1:e[t].order<e[n].order?-1:0}),i("asyncstart",{payload:e,order:t}),n(t,function(t){i(t,e[t])}),i("asyncend",e),f||(s=0)}}),f=!0),a[e]=t,t.order=c+=1},this.last=function(e){return o[e]},this.next=function(e){return a[e]}};i.async("set:");var s=function e(t,o){var i,s=Object.getPrototypeOf(t);if(a(t)&&(s===Object.prototype&&(i=Object.create(p))||s===Array.prototype&&(i=Object.setPrototypeOf([],h)))){var v={};function m(e,t){return function(){n(u(b),function(n){var i=b[n][e];r(i)&&i(),o.async(t+v[n],{p:n})})}}v[y]=function(e){return v[e]},v[d]=m(d,"remap:"),v[g]=m(g,"del:");var b=new Proxy(i,{get:function(e,t){if(t in e||t in v){if(!(t in e)&&t in v)return v[t]}else b[t]={};return v.hasOwnProperty(t)||(v[t]=f(c(32,48))),o.emit("get",{value:v[t]}),void 0===e[t]||null===e[t]?"":e[t]},set:function(t,n,i){var u=Object.getPrototypeOf(i),s=Array.isArray(t);if(s){var l=t.length;v.hasOwnProperty("length")||(v.length=f(c(32,48)))}var p=t[n]&&t[n][d];return r(p)&&p(),i&&a(i)&&(u===Object.prototype||u===Array.prototype)?t[n]=e(i,o):t[n]=i,v.hasOwnProperty(n)||(v[n]=f(c(32,48))),o.async("set:"+v[n],{value:t[n],p:n}),s&&l!==t.length&&o.async("set:"+v.length,{value:t.length,p:n}),!0},deleteProperty:function(e,t){if(t in e){var n=e[t][d];return r(n)&&n(),o.async("del:"+v[t],{value:e[t],p:t}),delete v[t],delete e[t]}return!1}});return l(t,b),b}}(t,i),m=A(e,s,i,o);return Object.defineProperty(m,o,{get:function(){return s},set:function(e){a(e)&&l(e,s)}}),m}}(function(s,sv={}){for(var k in sv)s="var "+k+" = sv."+k+";\n"+s;return eval(s)});